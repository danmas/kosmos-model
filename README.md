# AI Analytics Interface / Kosmos Model Gateway

Легковесный веб-интерфейс и API-шлюз для работы с LLM (Large Language Models). Объединяет провайдеров (GROQ, OpenRouter, Z.AI) в единый интерфейс с поддержкой RAG, управлением промптами и историей запросов.

## Основные возможности

*   **Мульти-провайдер:** Поддержка GROQ (Fast inference), OpenRouter (агрегатор) и Direct (Z.AI/Custom).
*   **Умная маршрутизация:**
    *   Системные алиасы: `FAST` (быстрая), `CHEAP` (дешевая/бесплатная), `RICH` (умная/дорогая).
    *   Автоматический фолбек и выбор провайдера.
*   **Управление моделями:** UI для включения/отключения моделей, назначения ролей и добавления кастомных моделей без перезагрузки.
*   **RAG (Retrieval-Augmented Generation):** Интеграция с LangChain и PostgreSQL (pgvector) для контекстного поиска по документам.
*   **История и Аналитика:** Сохранение всех запросов/ответов, подсчет токенов, повторное использование промптов.
*   **Файловая система:** Генерация и сохранение Markdown-отчетов.

## Установка и запуск

1.  **Установка зависимостей:**
    ```powershell
    npm install
    ```

2.  **Настройка окружения:**
    Создайте файл `.env` в корне проекта:
    ```env
    PORT=3002
    # API Keys
    GROQ_API_KEY=gsk_...
    OPENROUTER_API_KEY=sk-or-...
    # ZAI_API_KEY=... (опционально для Direct)

    # RAG Config (опционально)
    LANGCHAIN_PG_ENABLED=true
    LANGCHAIN_PG_URL=postgres://user:pass@localhost:5432/vector_db
    
    # N8N Integration (опционально)
    N8N_WEBHOOK_URL=...
    ```

3.  **Запуск:**
    ```powershell
    npm start
    ```
    Сервер запустится на `http://localhost:3002`.

## Структура проекта

*   `server.js` — Точка входа, Express сервер, API роуты.
*   `public/` — Статический фронтенд (Vanilla JS + CSS).
    *   `models.html` — Управление моделями.
    *   `main.html` — Основной интерфейс чата/анализа.
*   `available-models.json` — Локальная база конфигураций моделей.
*   `rag.js` — Сервис работы с векторной базой данных.
*   `groq-service.js` / `direct-service.js` — Клиенты провайдеров.

## Автоматическая синхронизация моделей

Сервер автоматически синхронизирует списки моделей от провайдеров Groq и OpenRouter, чтобы поддерживать их в актуальном состоянии.

- **Периодичность:** Синхронизация происходит при запуске сервера и далее каждые 8 часов.
- **Логика работы:**
    1.  Запрашивается актуальный список моделей у провайдера (Groq, OpenRouter).
    2.  **Новые модели**, которых нет в локальном файле `available-models.json`, автоматически добавляются.
    3.  **Устаревшие модели**, которые больше не присутствуют в ответе API, помечаются как отключенные (`enabled: false`), но не удаляются из файла.
    4.  **Ручные изменения** (например, если вы вручную отключили модель через UI) для существующих моделей сохраняются и не перезаписываются.

Это позволяет поддерживать список моделей актуальным, не теряя при этом кастомных настроек.

## API Документация

Полное описание REST API доступно в файле [README_REST.md](README_REST.md) или в формате [swagger.yaml](swagger.yaml).

